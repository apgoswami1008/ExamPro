<![CDATA[<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0"><%= exam.title %></h1>
        <div class="btn-group">
            <a href="/admin/exams/<%= exam.id %>/edit" class="btn btn-outline-primary">
                <i class="bi bi-pencil"></i> Edit Exam
            </a>
            <a href="/admin/exams/<%= exam.id %>/questions" class="btn btn-outline-secondary">
                <i class="bi bi-list-check"></i> Manage Questions
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Exam Details Card -->
            <div class="card mb-4">
                <div class="card-body">
                    <!-- Status -->
                    <div class="mb-4">
                        <span class="badge bg-<%= exam.isPublished ? 'success' : 'warning' %> mb-2">
                            <%= exam.isPublished ? 'Published' : 'Draft' %>
                        </span>
                        <% if (exam.price > 0) { %>
                            <span class="badge bg-info ms-2">Paid</span>
                        <% } else { %>
                            <span class="badge bg-secondary ms-2">Free</span>
                        <% } %>
                    </div>

                    <!-- Description -->
                    <div class="mb-4">
                        <h5 class="card-title">Description</h5>
                        <p class="card-text"><%= exam.description %></p>
                    </div>

                    <!-- Key Information -->
                    <div class="row mb-4">
                        <div class="col-sm-6 col-md-4 mb-3">
                            <h6 class="text-muted">Duration</h6>
                            <p class="mb-0"><%= exam.duration %> minutes</p>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-3">
                            <h6 class="text-muted">Total Marks</h6>
                            <p class="mb-0"><%= exam.totalMarks %></p>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-3">
                            <h6 class="text-muted">Passing Marks</h6>
                            <p class="mb-0"><%= exam.passingMarks %></p>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-3">
                            <h6 class="text-muted">Total Questions</h6>
                            <p class="mb-0"><%= exam.questions.length %></p>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-3">
                            <h6 class="text-muted">Allowed Attempts</h6>
                            <p class="mb-0"><%= exam.attempts === -1 ? 'Unlimited' : exam.attempts %></p>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-3">
                            <h6 class="text-muted">Price</h6>
                            <p class="mb-0">$<%= exam.price %></p>
                        </div>
                    </div>

                    <!-- Schedule -->
                    <div class="mb-4">
                        <h5 class="card-title">Schedule</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <h6 class="text-muted">Start Date & Time</h6>
                                <p class="mb-0">
                                    <%= exam.startTime ? new Date(exam.startTime).toLocaleString() : 'Not set' %>
                                </p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <h6 class="text-muted">End Date & Time</h6>
                                <p class="mb-0">
                                    <%= exam.endTime ? new Date(exam.endTime).toLocaleString() : 'Not set' %>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Settings -->
                    <div class="mb-4">
                        <h5 class="card-title">Settings</h5>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="bi <%= exam.shuffleQuestions ? 'bi-check-circle-fill text-success' : 'bi-x-circle-fill text-danger' %> me-2"></i>
                                Question Shuffling
                            </li>
                            <li class="mb-2">
                                <i class="bi <%= exam.showResult ? 'bi-check-circle-fill text-success' : 'bi-x-circle-fill text-danger' %> me-2"></i>
                                Immediate Results
                            </li>
                        </ul>
                    </div>

                    <!-- Instructions -->
                    <div class="mb-4">
                        <h5 class="card-title">Instructions</h5>
                        <div class="card bg-light">
                            <div class="card-body">
                                <%= exam.instructions %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Questions Preview -->
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="card-title mb-0">Questions</h5>
                        <a href="/admin/exams/<%= exam.id %>/questions" class="btn btn-sm btn-primary">
                            Manage Questions
                        </a>
                    </div>

                    <% if (exam.questions && exam.questions.length > 0) { %>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th style="width: 50px">#</th>
                                        <th>Question</th>
                                        <th>Type</th>
                                        <th style="width: 100px">Marks</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% exam.questions.forEach((question, index) => { %>
                                        <tr>
                                            <td><%= index + 1 %></td>
                                            <td>
                                                <%= question.text.length > 100 ? 
                                                    question.text.substring(0, 100) + '...' : 
                                                    question.text %>
                                            </td>
                                            <td>
                                                <span class="badge bg-secondary">
                                                    <%= question.type %>
                                                </span>
                                            </td>
                                            <td class="text-end"><%= question.marks %></td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                        </div>
                    <% } else { %>
                        <div class="text-center py-4">
                            <div class="text-muted">
                                <i class="bi bi-file-earmark-text fs-2 d-block mb-2"></i>
                                No questions added yet
                            </div>
                            <a href="/admin/exams/<%= exam.id %>/questions/create" class="btn btn-sm btn-primary mt-2">
                                Add First Question
                            </a>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Statistics Card -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Statistics</h5>
                    <div class="row">
                        <div class="col-6 mb-3">
                            <h6 class="text-muted">Total Attempts</h6>
                            <h3 class="mb-0"><%= exam.examAttempts.length %></h3>
                        </div>
                        <div class="col-6 mb-3">
                            <h6 class="text-muted">Pass Rate</h6>
                            <h3 class="mb-0">
                                <%= exam.examAttempts.length > 0 ? 
                                    Math.round((exam.examAttempts.filter(a => a.score >= exam.passingMarks).length / 
                                    exam.examAttempts.length) * 100) : 0 %>%
                            </h3>
                        </div>
                        <div class="col-6">
                            <h6 class="text-muted">Avg. Score</h6>
                            <h3 class="mb-0">
                                <%= exam.examAttempts.length > 0 ? 
                                    Math.round(exam.examAttempts.reduce((acc, curr) => acc + curr.score, 0) / 
                                    exam.examAttempts.length) : 0 %>
                            </h3>
                        </div>
                        <div class="col-6">
                            <h6 class="text-muted">Enrollments</h6>
                            <h3 class="mb-0"><%= exam.enrollments ? exam.enrollments.length : 0 %></h3>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Quick Actions</h5>
                    <div class="list-group list-group-flush">
                        <a href="/admin/exams/<%= exam.id %>/preview" 
                           class="list-group-item list-group-item-action">
                            <i class="bi bi-eye me-2"></i>
                            Preview Exam
                        </a>
                        <a href="/admin/exams/<%= exam.id %>/results" 
                           class="list-group-item list-group-item-action">
                            <i class="bi bi-bar-chart me-2"></i>
                            View Results
                        </a>
                        <a href="/admin/exams/<%= exam.id %>/enrollments" 
                           class="list-group-item list-group-item-action">
                            <i class="bi bi-people me-2"></i>
                            Manage Enrollments
                        </a>
                        <button onclick="duplicateExam('<%= exam.id %>')"
                                class="list-group-item list-group-item-action">
                            <i class="bi bi-files me-2"></i>
                            Duplicate Exam
                        </button>
                        <% if (!exam.isPublished) { %>
                            <button onclick="publishExam('<%= exam.id %>')"
                                    class="list-group-item list-group-item-action text-success">
                                <i class="bi bi-check-circle me-2"></i>
                                Publish Exam
                            </button>
                        <% } else { %>
                            <button onclick="unpublishExam('<%= exam.id %>')"
                                    class="list-group-item list-group-item-action text-warning">
                                <i class="bi bi-x-circle me-2"></i>
                                Unpublish Exam
                            </button>
                        <% } %>
                        <% if (!exam.isPublished) { %>
                            <button onclick="deleteExam('<%= exam.id %>')"
                                    class="list-group-item list-group-item-action text-danger">
                                <i class="bi bi-trash me-2"></i>
                                Delete Exam
                            </button>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function publishExam(examId) {
    if (confirm('Are you sure you want to publish this exam? This will make it visible to students.')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/exams/${examId}/publish`;
        
        const methodInput = document.createElement('input');
        methodInput.type = 'hidden';
        methodInput.name = '_method';
        methodInput.value = 'PATCH';
        
        form.appendChild(methodInput);
        document.body.appendChild(form);
        form.submit();
    }
}

function unpublishExam(examId) {
    if (confirm('Are you sure you want to unpublish this exam? Students will no longer be able to access it.')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/exams/${examId}/unpublish`;
        
        const methodInput = document.createElement('input');
        methodInput.type = 'hidden';
        methodInput.name = '_method';
        methodInput.value = 'PATCH';
        
        form.appendChild(methodInput);
        document.body.appendChild(form);
        form.submit();
    }
}

function deleteExam(examId) {
    if (confirm('Are you sure you want to delete this exam? This action cannot be undone.')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/exams/${examId}`;
        
        const methodInput = document.createElement('input');
        methodInput.type = 'hidden';
        methodInput.name = '_method';
        methodInput.value = 'DELETE';
        
        form.appendChild(methodInput);
        document.body.appendChild(form);
        form.submit();
    }
}

function duplicateExam(examId) {
    if (confirm('Do you want to create a copy of this exam?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/exams/${examId}/duplicate`;
        document.body.appendChild(form);
        form.submit();
    }
}
</script>]]>