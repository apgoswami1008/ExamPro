<!-- Page Header -->
<div class="page-header">
    <h1 class="page-title">Dashboard Overview</h1>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/admin">Admin</a></li>
            <li class="breadcrumb-item active">Dashboard</li>
        </ol>
    </nav>
</div>

<!-- Statistics Cards -->
<div class="row g-4 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="stat-card">
            <div class="stat-icon primary">
                <i class="bi bi-people"></i>
            </div>
            <div class="stat-value"><%= stats.totalUsers || 1247 %></div>
            <div class="stat-label">Total Users</div>
            <div class="stat-trend up">
                <i class="bi bi-arrow-up"></i>
                <span>12.5% from last month</span>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stat-card">
            <div class="stat-icon success">
                <i class="bi bi-journal-text"></i>
            </div>
            <div class="stat-value"><%= stats.totalExams || 87 %></div>
            <div class="stat-label">Total Exams</div>
            <div class="stat-trend up">
                <i class="bi bi-arrow-up"></i>
                <span>8.2% from last month</span>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stat-card">
            <div class="stat-icon warning">
                <i class="bi bi-clipboard-check"></i>
            </div>
            <div class="stat-value"><%= stats.totalAttempts || 3542 %></div>
            <div class="stat-label">Total Attempts</div>
            <div class="stat-trend up">
                <i class="bi bi-arrow-up"></i>
                <span>23.1% from last month</span>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stat-card">
            <div class="stat-icon danger">
                <i class="bi bi-currency-dollar"></i>
            </div>
            <div class="stat-value">$<%= stats.totalRevenue || '12,450' %></div>
            <div class="stat-label">Total Revenue</div>
            <div class="stat-trend up">
                <i class="bi bi-arrow-up"></i>
                <span>15.3% from last month</span>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row g-4 mb-4">
    <div class="col-xl-8">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 pt-4 px-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="mb-1">User Growth & Exam Participation</h5>
                        <p class="text-muted small mb-0">Monthly statistics overview</p>
                    </div>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-outline-primary active">6M</button>
                        <button type="button" class="btn btn-sm btn-outline-primary">1Y</button>
                        <button type="button" class="btn btn-sm btn-outline-primary">All</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <canvas id="growthChart" height="80"></canvas>
            </div>
        </div>
    </div>

    <div class="col-xl-4">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 pt-4 px-4">
                <h5 class="mb-1">Exam Categories</h5>
                <p class="text-muted small mb-0">Distribution by category</p>
            </div>
            <div class="card-body">
                <canvas id="categoryChart" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity & Top Performers -->
<div class="row g-4">
    <div class="col-xl-8">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 pt-4 px-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="mb-1">Recent Exam Attempts</h5>
                        <p class="text-muted small mb-0">Latest user activities</p>
                    </div>
                    <a href="/admin/results" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th class="px-4">User</th>
                                <th>Exam</th>
                                <th>Score</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% 
                            const recentAttempts = typeof attempts !== 'undefined' ? attempts : [
                                { id: 1, user: 'John Doe', exam: 'JavaScript Basics', score: 85, status: 'pass', date: '2 hours ago' },
                                { id: 2, user: 'Jane Smith', exam: 'React Advanced', score: 92, status: 'pass', date: '3 hours ago' },
                                { id: 3, user: 'Mike Johnson', exam: 'Node.js Fundamentals', score: 67, status: 'pass', date: '5 hours ago' },
                                { id: 4, user: 'Sarah Williams', exam: 'Python Basics', score: 45, status: 'fail', date: '6 hours ago' },
                                { id: 5, user: 'Tom Brown', exam: 'Database Design', score: 78, status: 'pass', date: '8 hours ago' }
                            ];
                            recentAttempts.forEach(function(attempt) { %>
                                <tr>
                                    <td class="px-4">
                                        <div class="d-flex align-items-center">
                                            <div class="user-avatar me-2" style="width: 32px; height: 32px; font-size: 0.75rem;">
                                                <%= attempt.user.charAt(0) %>
                                            </div>
                                            <span><%= attempt.user %></span>
                                        </div>
                                    </td>
                                    <td><%= attempt.exam %></td>
                                    <td><span class="badge bg-<%= attempt.score >= 70 ? 'success' : 'warning' %>"><%= attempt.score %>%</span></td>
                                    <td>
                                        <span class="badge bg-<%= attempt.status === 'pass' ? 'success' : 'danger' %>">
                                            <%= attempt.status.toUpperCase() %>
                                        </span>
                                    </td>
                                    <td><small class="text-muted"><%= attempt.date %></small></td>
                                    <td>
                                        <button class="btn btn-sm btn-link" title="View Details">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-4">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 pt-4 px-4">
                <h5 class="mb-1">Top Performers</h5>
                <p class="text-muted small mb-0">Highest scoring users</p>
            </div>
            <div class="card-body">
                <% 
                const topPerformers = [
                    { name: 'Alice Johnson', score: 98, exams: 15, avatar: 'A' },
                    { name: 'Bob Wilson', score: 96, exams: 12, avatar: 'B' },
                    { name: 'Carol Davis', score: 94, exams: 18, avatar: 'C' },
                    { name: 'David Lee', score: 92, exams: 10, avatar: 'D' },
                    { name: 'Emma Garcia', score: 90, exams: 14, avatar: 'E' }
                ];
                topPerformers.forEach(function(performer, index) { %>
                    <div class="d-flex align-items-center mb-3 pb-3 <%= index < topPerformers.length - 1 ? 'border-bottom' : '' %>">
                        <div class="me-3">
                            <div class="user-avatar" style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2);">
                                <%= performer.avatar %>
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <div class="fw-semibold"><%= performer.name %></div>
                            <small class="text-muted"><%= performer.exams %> exams completed</small>
                        </div>
                        <div class="text-end">
                            <div class="fw-bold text-success"><%= performer.score %>%</div>
                            <small class="text-muted">Avg Score</small>
                        </div>
                    </div>
                <% }); %>
            </div>
        </div>
    </div>
</div>

<!-- Chart Scripts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // User Growth Chart
    const ctx1 = document.getElementById('growthChart').getContext('2d');
    new Chart(ctx1, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'New Users',
                data: [65, 78, 90, 112, 134, 165],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'Exam Attempts',
                data: [200, 245, 310, 385, 445, 520],
                borderColor: '#22c55e',
                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Category Chart
    const ctx2 = document.getElementById('categoryChart').getContext('2d');
    new Chart(ctx2, {
        type: 'doughnut',
        data: {
            labels: ['Programming', 'Mathematics', 'Science', 'Languages', 'Business'],
            datasets: [{
                data: [35, 25, 20, 12, 8],
                backgroundColor: [
                    '#3b82f6',
                    '#22c55e',
                    '#f59e0b',
                    '#ef4444',
                    '#8b5cf6'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
});
</script>

<style>
.card {
    border-radius: 0.75rem;
}

.card-header {
    padding: 1.5rem;
}

.card-body {
    padding: 1.5rem;
}

.table th {
    font-weight: 600;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #64748b;
}

.table td {
    font-size: 0.9375rem;
    padding: 1rem 0.75rem;
}

.user-avatar {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-weight: 600;
    font-size: 0.875rem;
}
</style>
