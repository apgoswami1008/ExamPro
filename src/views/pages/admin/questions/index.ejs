<![CDATA[<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0">Questions for <%= exam.title %></h1>
            <p class="text-muted mb-0">
                <%= exam.questions.length %> questions â€¢ <%= exam.totalMarks %> total marks
            </p>
        </div>
        <div class="btn-group">
            <button type="button" 
                    class="btn btn-primary dropdown-toggle" 
                    data-bs-toggle="dropdown" 
                    aria-expanded="false">
                <i class="bi bi-plus-lg"></i> Add Question
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
                <li>
                    <a class="dropdown-item" href="/admin/exams/<%= exam.id %>/questions/create?type=mcq">
                        <i class="bi bi-list-check me-2"></i> Multiple Choice
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="/admin/exams/<%= exam.id %>/questions/create?type=true-false">
                        <i class="bi bi-check2-square me-2"></i> True/False
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="/admin/exams/<%= exam.id %>/questions/create?type=match">
                        <i class="bi bi-arrow-left-right me-2"></i> Match the Following
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="/admin/exams/<%= exam.id %>/questions/create?type=descriptive">
                        <i class="bi bi-card-text me-2"></i> Descriptive
                    </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <a class="dropdown-item" href="/admin/exams/<%= exam.id %>/questions/import">
                        <i class="bi bi-upload me-2"></i> Import Questions
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body">
            <form class="row g-3" method="GET">
                <div class="col-md-3">
                    <label for="search" class="form-label">Search</label>
                    <input type="text" 
                           class="form-control" 
                           id="search" 
                           name="search"
                           value="<%= typeof query !== 'undefined' ? query.search : '' %>"
                           placeholder="Search questions">
                </div>
                <div class="col-md-3">
                    <label for="type" class="form-label">Question Type</label>
                    <select class="form-select" id="type" name="type">
                        <option value="">All Types</option>
                        <option value="mcq" <%= typeof query !== 'undefined' && query.type === 'mcq' ? 'selected' : '' %>>Multiple Choice</option>
                        <option value="true-false" <%= typeof query !== 'undefined' && query.type === 'true-false' ? 'selected' : '' %>>True/False</option>
                        <option value="match" <%= typeof query !== 'undefined' && query.type === 'match' ? 'selected' : '' %>>Match the Following</option>
                        <option value="descriptive" <%= typeof query !== 'undefined' && query.type === 'descriptive' ? 'selected' : '' %>>Descriptive</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="difficulty" class="form-label">Difficulty</label>
                    <select class="form-select" id="difficulty" name="difficulty">
                        <option value="">All Levels</option>
                        <option value="easy" <%= typeof query !== 'undefined' && query.difficulty === 'easy' ? 'selected' : '' %>>Easy</option>
                        <option value="medium" <%= typeof query !== 'undefined' && query.difficulty === 'medium' ? 'selected' : '' %>>Medium</option>
                        <option value="hard" <%= typeof query !== 'undefined' && query.difficulty === 'hard' ? 'selected' : '' %>>Hard</option>
                    </select>
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary me-2">Filter</button>
                    <a href="/admin/exams/<%= exam.id %>/questions" class="btn btn-secondary">Reset</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Questions List -->
    <div class="card">
        <div class="card-body">
            <% if (typeof questions !== 'undefined' && questions.length > 0) { %>
                <div class="questions-list">
                    <% questions.forEach((question, index) => { %>
                        <div class="question-item card mb-4">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div class="d-flex align-items-center">
                                        <span class="badge bg-secondary me-2">#<%= index + 1 %></span>
                                        <span class="badge bg-primary me-2"><%= question.type %></span>
                                        <span class="badge bg-info"><%= question.difficulty %></span>
                                    </div>
                                    <div class="btn-group">
                                        <a href="/admin/exams/<%= exam.id %>/questions/<%= question.id %>/edit" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <button type="button" 
                                                class="btn btn-sm btn-outline-danger"
                                                onclick="deleteQuestion('<%= question.id %>')">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="question-text mb-3">
                                    <% if (question.imageUrl) { %>
                                        <img src="<%= question.imageUrl %>" 
                                             alt="Question Image" 
                                             class="img-fluid mb-2"
                                             style="max-height: 200px;">
                                    <% } %>
                                    <div><%= question.text %></div>
                                </div>

                                <% if (question.type === 'mcq') { %>
                                    <div class="options-list">
                                        <% question.options.forEach((option, optIndex) => { %>
                                            <div class="form-check">
                                                <input class="form-check-input" 
                                                       type="radio" 
                                                       disabled 
                                                       <%= question.correctAnswer.includes(optIndex) ? 'checked' : '' %>>
                                                <label class="form-check-label">
                                                    <%= option %>
                                                </label>
                                            </div>
                                        <% }); %>
                                    </div>
                                <% } else if (question.type === 'true-false') { %>
                                    <div class="form-check">
                                        <input class="form-check-input" 
                                               type="radio" 
                                               disabled 
                                               <%= question.correctAnswer ? 'checked' : '' %>>
                                        <label class="form-check-label">True</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" 
                                               type="radio" 
                                               disabled 
                                               <%= !question.correctAnswer ? 'checked' : '' %>>
                                        <label class="form-check-label">False</label>
                                    </div>
                                <% } else if (question.type === 'match') { %>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <% question.options.left.forEach((item, i) => { %>
                                                <div class="mb-2">
                                                    <%= i + 1 %>. <%= item %>
                                                </div>
                                            <% }); %>
                                        </div>
                                        <div class="col-md-6">
                                            <% question.options.right.forEach((item, i) => { %>
                                                <div class="mb-2">
                                                    <%= String.fromCharCode(65 + i) %>. <%= item %>
                                                </div>
                                            <% }); %>
                                        </div>
                                    </div>
                                <% } %>

                                <div class="mt-3 d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="text-muted">Marks: <%= question.marks %></span>
                                        <% if (question.negativeMarks > 0) { %>
                                            <span class="text-danger ms-2">
                                                Negative: -<%= question.negativeMarks %>
                                            </span>
                                        <% } %>
                                    </div>
                                    <% if (question.explanation) { %>
                                        <button type="button" 
                                                class="btn btn-sm btn-link"
                                                data-bs-toggle="collapse"
                                                data-bs-target="#explanation-<%= question.id %>">
                                            Show Explanation
                                        </button>
                                    <% } %>
                                </div>

                                <% if (question.explanation) { %>
                                    <div class="collapse mt-2" id="explanation-<%= question.id %>">
                                        <div class="card card-body bg-light">
                                            <%= question.explanation %>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    <% }); %>
                </div>

                <!-- Pagination -->
                <% if (typeof pagination !== 'undefined') { %>
                    <nav aria-label="Question navigation" class="mt-4">
                        <ul class="pagination justify-content-center">
                            <li class="page-item <%= pagination.currentPage === 1 ? 'disabled' : '' %>">
                                <a class="page-link" href="?page=<%= pagination.currentPage - 1 %>" tabindex="-1">Previous</a>
                            </li>
                            <% for(let i = 1; i <= pagination.totalPages; i++) { %>
                                <li class="page-item <%= pagination.currentPage === i ? 'active' : '' %>">
                                    <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                                </li>
                            <% } %>
                            <li class="page-item <%= pagination.currentPage === pagination.totalPages ? 'disabled' : '' %>">
                                <a class="page-link" href="?page=<%= pagination.currentPage + 1 %>">Next</a>
                            </li>
                        </ul>
                    </nav>
                <% } %>
            <% } else { %>
                <div class="text-center py-5">
                    <div class="mb-4">
                        <i class="bi bi-journal-text display-4 text-muted"></i>
                    </div>
                    <h5>No Questions Added Yet</h5>
                    <p class="text-muted mb-4">Get started by adding your first question to this exam.</p>
                    <div class="btn-group">
                        <a href="/admin/exams/<%= exam.id %>/questions/create?type=mcq" 
                           class="btn btn-primary">
                            Add First Question
                        </a>
                        <a href="/admin/exams/<%= exam.id %>/questions/import" 
                           class="btn btn-outline-primary">
                            Import Questions
                        </a>
                    </div>
                </div>
            <% } %>
        </div>
    </div>
</div>

<!-- Delete Question Modal -->
<div class="modal fade" id="deleteQuestionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Question</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this question? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteQuestionForm" method="POST">
                    <input type="hidden" name="_method" value="DELETE">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function deleteQuestion(questionId) {
    const modal = new bootstrap.Modal(document.getElementById('deleteQuestionModal'));
    const form = document.getElementById('deleteQuestionForm');
    form.action = `/admin/exams/<%= exam.id %>/questions/${questionId}`;
    modal.show();
}
</script>]]>